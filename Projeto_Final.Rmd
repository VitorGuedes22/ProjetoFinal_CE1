---
title: "Projeto Final - CE1/2024.1"
author: 
  - name: "Vitor Guedes Frade/221017130"
  - name: "Leonardo Pedroso Sallet/232027897"
  - name: "Ítalo Andrade dos Santos/232026773"
  - name: "Luis Felipe Alvaro da Graca/222036032"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}

```

## Introdução

Este trabalho foi realizado com o objetivo de estudar tendências salariais entre os jogadores de futebol ao redor do mundo, usando como base de dados [esta fonte](https://www.kaggle.com/datasets/ultimus/football-salaries-dataset) para a análise descritiva contida neste relatório. A base de dados referida obteve seus dados coletados entre 2023 e 2024 e possui informações de aproximadamente 40.000 jogadores. O banco de dados possui duas tabelas com as respectivas colunas em arquivos ".csv":

### Tabela 1: rawWages

- **Name**: Nome
- **Club**: Clube
- **Division**: Divisão
- **Based**: Sede (ou Localização)
- **Nat**: Nacionalidade
- **EU.National**: Nacional da União Europeia
- **Caps**: Participações na Seleção
- **AT.Apps**: Aplicações AT (ou Jogos AT, dependendo do contexto)
- **Position**: Posição
- **Age**: Idade
- **CR**: Reputação do Clube (Club Reputation)
- **Begins**: Início do Contrato
- **Expires**: Fim do Contrato
- **Last.Club**: Último Clube
- **Last.Trans..Fee**: Última Taxa de Transferência
- **Salary**: Salário

### Tabela 2: wagesCleaned

- **Is_top_5_League**: Está nas Top 5 Ligas
- **Based_rich_nation**: Baseado em Nação Rica
- **Is_top_ranked_nation**: É de Nação Bem Classificada
- **EU_National**: Nacional da União Europeia
- **Caps**: Participações na Seleção
- **Apps**: Aplicações (ou Jogos, dependendo do contexto)
- **Age**: Idade
- **Reputation**: Reputação
- **Is_top_prev_club**: Está no Top Clube Anterior
- **Last_Transfer_Fee**: Última Taxa de Transferência
- **Salary**: Salário

## Preparação do Ambiente de programação

```{r instala_pacotes, echo=TRUE, message=FALSE, warning=FALSE}
#install.packages("ggplot2")
#install.packages("dplyr")
library(ggplot2)
library(dplyr)

# Definir o diretório de trabalho (coloque o caminho que voce usa no seu PC)
setwd("C:/Users/vitor/OneDrive/Documentos/Materias_UNB/CE1/ProjetoFinal_CE1")

#### Lendo os dados
rawWages <- read.csv("raw_wages.csv")
wagesClaned <- read.csv("wages_cleaned.csv")

#### TOPICO 1
salarios <- wagesClaned[,"Salary"]
participacaoSelecao <- wagesClaned[,"Caps"]

```

## Análise Descritiva

As análises foram divididas em diferentes tópicos para serem produzidas correlacionando diferentes atributos dos dados com diferentes funções matemáticas e geração de gráficos distintos. Seguem os tópicos a seguir:

### Tópico 1: Correlação entre Salário e Participações na Seleção (Caps)

#### **Hipótese:**  
  Jogadores com mais participações na seleção tendem a obter melhores salários.  
  
#### Metodologia de análise:
  A analise em questão foi baseada na estimativa de que uma imagem de salario x caps deveria seguir tendencia de crescimento positiva do contradominio em relação ao dominio. Tecnicas de inferncia realizadas:

##### Coeficiente de correlação de Pearson

  O coeficiente de correlação de Pearson é um teste que mede a relação estatística entre duas variáveis contínuas. Se a associação entre os elementos não for linear, o coeficiente não será representado adequadamente.  
  O coeficiente de correlação de Pearson pode ter um intervalo de valores de +1 a -1. Um valor de 0 indica que não há associação entre as duas variáveis. Um valor maior que 0 indica uma associação positiva. Isto é, as variaveis são diretamente proporcionais. Um valor menor que 0 indica uma associação negativa. Isto é,as variaveis são inversamente proporcionais.
  
  \[ r = \frac{n(\sum xy) - (\sum x)(\sum y)}{\sqrt{[n \sum x^2 - (\sum x)^2][n \sum y^2 - (\sum y)^2]}} \]

  A equação acima representa a fórmula para calcular o coeficiente, onde X e Y são duas variáveis contínuas. Para realizar tal cálculo e inferência, serão utilizadas funções próprias do R, onde passam-se conjuntos de dados das variáveis em questão como parâmetro, e a função retorna o coeficiente calculado, assim simplificando o código e eliminando a necessidade de implementação manual da equação acima. Segue a solução em R:
  

```{r t1_1, echo=TRUE, message=FALSE, warning=FALSE}
salarios <- wagesClaned[,"Salary"]
participacaoSelecao <- wagesClaned[,"Caps"]

# Calcula correlacao de Person usando funcao do R
correlacaoPearson <- cor(salarios, participacaoSelecao, method = "pearson")
correlacaoPearson

```
  
  O coeficiente de correlação de Pearson calculado acima foi 0.2552929, que é maior que 0, então a associação entre as duas variáveis em questão é verdadeira, sendo de força fraca. Além disso, foi gerado um gráfico com a linha da média salarial dos jogadores para cada valor de caps encontrado na base de dados. Seguem o código e os resultados: 
  
  
```{r t1_2, echo=TRUE, message=FALSE, warning=FALSE}
data <- data.frame(Salario = salarios, ParticipacaoSelecao = participacaoSelecao)

# Calcular a média salarial para cada valor de Caps
media_salarial_por_caps <- data %>%
  group_by(ParticipacaoSelecao) %>%
  summarise(media_salarial = mean(Salario, na.rm = TRUE))

# Criar o gráfico de linha contínua da média salarial em função das participações na seleção
ggplot(media_salarial_por_caps, aes(x = ParticipacaoSelecao, y = media_salarial)) +
  geom_line(color = "blue") +  # Adiciona uma linha contínua azul
  labs(title = "Média Salarial em Função das Participações na Seleção",
       x = "Participações na Seleção (Caps)",
       y = "Média Salarial") +
  theme_minimal()
```

#### Conclusões do Tópico 1
  Observa-se no plot acima que as maiores médias salariais são de jogadores com mais caps, mas, como esperado pela correlação fraca, o crescimento não é contínuo ao longo de toda a imagem. Portanto, compreende-se que o aumento de caps para um jogador tende a aumentar seu salário, mas isso não é uma regra para todos os casos. Esse aumento depende também de outras variáveis. 


### Tópico 2: Impacto da Idade no Salário

#### **Hipotése:**  
  Jogadores com mais velhos tendem a obter melhores salários. 
  
#### Metodologia de analise
  Como podemos encontrar vários jogadores com uma mesma idade na base de dados, não podemos escolher um jogador arbitrario da base de dados para cada idade a fim de comparação. Então a analise foi feita comparando as medias salariais por idade, assim foram obtidas a regrassão linear da variação de salário por idade, media e desvio padrão e plotadas em um gráfico para inferencia. Seguem abaixo os códigos para inferencia dos dados:
  
  
```{r t2_1, echo=TRUE, message=FALSE, warning=FALSE}
# Calcular as estatísticas resumo por idade
summary_stats <- wagesClaned %>%
  group_by(Age) %>%
  summarise(
    mean_salary = mean(Salary, na.rm = TRUE),
    sd_salary = sd(Salary, na.rm = TRUE)
  )
```
  
  - Acima foi calculada média salárial e desvio padrão agrupado por idade, e abaixo foram plotados os dados em uma gráfico de idade x média salarial: 
  
    
```{r t2_2, echo=TRUE, message=FALSE, warning=FALSE}
# Adicionar uma coluna para a área do desvio padrão para usar na legenda
summary_stats$fill_group <- "Desvio Padrão"

# Criar o gráfico com legendas
ggplot(summary_stats, aes(x = Age, y = mean_salary)) +
  geom_line(aes(color = "Média Salarial"), size = 1) +  # Linha da média salarial
  geom_ribbon(aes(ymin = mean_salary - sd_salary, ymax = mean_salary + sd_salary, fill = fill_group), alpha = 0.3) +  # Área do desvio padrão
  geom_smooth(aes(color = "Regressão Linear"), method = "lm", linetype = "dashed", size = 1) +  # Linha de regressão linear
  labs(title = "Média Salarial por Idade com Desvio Padrão",
       x = "Idade (anos)",
       y = "Média Salarial",
       fill = "Legenda",
       color = "Legenda") +
  scale_y_continuous(limits = c(0, 1.1 * max(summary_stats$mean_salary, na.rm = TRUE))) +  # Ajustar a escala do eixo y para uma melhor visualização
  scale_color_manual(values = c("Média Salarial" = "darkgreen", "Regressão Linear" = "blue")) +
  scale_fill_manual(values = c("Desvio Padrão" = "gray")) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
        axis.title = element_text(size = 12, face = "bold"),
        axis.text = element_text(size = 10),
        legend.position = "bottom")
```
  
#### Conclusão do tópico 2
  A regressão linear deu uma reta com coeficiente angular quase nulo, indicando que não há uma tendência clara de aumento ou diminuição significativa do salário médio com a idade.Mas tratando-se de uma média as cordenadas apresentam desvio padrão, que esta apresentando alta variabilidade entre os salarios dos jogadores, onde notóriamente entre os salários são mais próximos da estimativa salarial no intervalor de 25 e 35 anos. Contudo, a imagem da média salarial possui linha de crescimento predominantemente positiva em grandes intervalos do dominio, então podemos concluir uma baixa relação de crescimento entre as duas variáveis, e que depende de outras para o mesmo. A regressão linear resultou em uma reta com coeficiente angular quase nulo, indicando que não há uma tendência clara de aumento ou diminuição significativa do salário médio com a idade. No entanto, as médias das coordenadas apresentam um desvio padrão, evidenciando alta variabilidade entre os salários dos jogadores. Notoriamente, os salários são mais próximos da estimativa salarial no intervalo entre 25 e 35 anos.

Contudo, a linha da média salarial apresenta uma tendência de crescimento predominantemente positiva em grandes intervalos do domínio. Portanto, podemos concluir que existe uma baixa relação de crescimento entre as duas variáveis, e que essa relação depende de outros fatores para se manifestar plenamente.


### Tópico 3: Influência da Nacionalidade Europeia no Salário

#### **Hipótese** 
  Dado o tamanho extenso do banco de dados, verificamos quantos países estão representados e suas respectivas contagens de jogadores. Foram selecionados os países mais predominantes para conduzir as inferências. Com mais de dois países para comparação, realizamos uma ANOVA seguida por um teste de Tukey HSD. Abaixo estão os códigos e as inferências realizadas:
#### Metodologia de análise 
  Sendo o banco de dados muito grande, foram conferidos quantos paises estão presentes e suas respectivas quantidades de jogadores, e selecionados os paises mais predominantes para realizar as inferencias. Sendo a quantidade de paises em comparação maior que dois, realizamos uma ANOVA seguida de um teste de Tukey HSD.Segue os codigos e inferencias realizadas: 
  
```{r t3_1, echo=TRUE, message=FALSE, warning=FALSE}
# Remover caracteres não numéricos e converter para numérico
rawWages$Salary <- as.numeric(gsub("[^0-9]", "", rawWages$Salary))

#filtrar os jogadores por idade 
rawWages_clean <- rawWages %>%
  filter(!is.na(Salary) & Age >= 25 & Age <= 35)

#Identificar as 5 nacionalidades mais predominantes
top_5_nationalities <- rawWages_clean %>%
  group_by(Nat) %>%
  summarise(count = n()) %>%
  arrange(desc(count)) %>%
  top_n(5, count) %>%
  pull(Nat)


#Obter os jogadores das 5 nacionalidades mais predominantes
rawWages_clean <- rawWages_clean %>%
  filter(Nat %in% top_5_nationalities)
```
  
  No trecho acima Foram obtidos os jogadores dos 5 paises mais predominantes que estão na faixa etaria de 25 a 35 anos de idade. Sendo os paises: 
  
```{r t3_2, echo=TRUE, message=FALSE, warning=FALSE}
top_5_nationalities
```
   
   - Quantidade de jogadores presentes no conjuntos 5 paises em questão:

```{r t3_3, echo=TRUE, message=FALSE, warning=FALSE}
length(rawWages_clean[,"Name"])
```
  

##### Resultados da ANOVA

  Os resultados da ANOVA indicam que há uma diferença significativa nos salários dos jogadores com base na nacionalidade.

```{r t3_4, echo=TRUE, message=FALSE, warning=FALSE}
# Executar a ANOVA
anova_result <- aov(Salary ~ Nat, data = rawWages_clean)

# Ver os resultados da ANOVA
summary(anova_result)
``` 

   Os resultados indicam que há uma diferença estatisticamente significativa nos salários dos jogadores entre diferentes nacionalidades (Valor F = 6.074, Valor p = 7.09e-05). Isso sugere que a nacionalidade é um fator que influencia significativamente os salários dos jogadores. A significância estatística (valor p < 0.05) nos permite rejeitar a hipótese nula de que não há diferença nos salários médios entre as nacionalidades.
  
##### Testes Post-Hoc
  Para identificar especificamente quais nacionalidades diferem entre si, realizamos o teste de Tukey HSD.
  
```{r t3_5, echo=TRUE, message=FALSE, warning=FALSE}
# Teste Tukey HSD (Honest Significant Difference)
tukey_result <- TukeyHSD(anova_result)

# Ver os resultados do teste Tukey
print(tukey_result)
``` 
  
  - Visualização do teste Post-Hoc em gráfico:
  
```{r t3_6, echo=TRUE, message=FALSE, warning=FALSE}
# Extrair resultados do teste de Tukey
tukey_data <- as.data.frame(tukey_result$Nat)
tukey_data$comparison <- rownames(tukey_data)

# Gráfico dos Resultados do Teste de Tukey HSD
ggplot(tukey_data, aes(x = comparison, y = diff, ymin = lwr, ymax = upr)) +
  geom_errorbar(width = 0.2) +
  geom_point() +
  labs(title = "Resultados do Teste de Tukey HSD",
       x = "Comparação de Nacionalidades",
       y = "Diferença de Salário") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))
``` 

###### Como interpretar o Gráfico:

  1. **Eixo Y (Diferença de Salário)**:
    - Representa a diferença média nos salários dos jogadores entre os diferentes pares de nacionalidades.
    - Os valores variam de aproximadamente -500.000 a +500.000, indicando a magnitude e a direção da diferença salarial entre as nacionalidades comparadas.

  2. **Eixo X (Comparação de Nacionalidades)**:
    - Mostra as comparações entre diferentes pares de nacionalidades, como ESP-ENG (Espanha vs. Inglaterra), FRA-ENG (França vs. Inglaterra), etc.
    - Cada ponto no gráfico representa a diferença média de salário entre as duas nacionalidades.

  3. **Intervalos de Confiança**:
    - As barras de erro ao redor de cada ponto representam os intervalos de confiança para a diferença média de salário.
    - Se o intervalo de confiança inclui zero, isso indica que a diferença de salário entre essas duas nacionalidades não é estatisticamente significativa.

##### Conclusões do Tópico 3

- Diferença entre Espanha e Inglaterra (ESP-ENG):A diferença média de salário é próxima de zero e não é significativa.

- Diferença entre França e Espanha (FRA-ESP):A diferença média de salário também não é significativa.

- Diferença entre Alemanha e Inglaterra (GER-ENG):A diferença média de salário é pequena e não significativa.

- Diferença entre Itália e Alemanha (ITA-GER):A diferença média de salário é próxima de zero e não é significativa.

  Nenhuma das comparações entre as nacionalidades mostra uma diferença de salário estatisticamente significativa. Portanto, dentro do conjunto de dados analisado, os salários dos jogadores de futebol não variam significativamente com base na nacionalidade.
  

### Tópico 4: Relação salárial com a riqueza da nação do jogador

#### **Hipótese**
  Jogadores pertencentes as nações consideradas ricas possuem maiores médias saláriais.
  
#### Metodologia de análise
   Para realizar a inferência e obter resultados, os jogadores foram separados de acordo com a coluna "Based_rich_nation", que indica se pertencem a países ricos ou não. Após a separação, os conjuntos foram identificados e ordenados de maneira crescente pelas medianas, e foram gerados boxplots para inferir os dados e confirmar a hipótese.
   
   
```{r t4_1, echo=TRUE, message=FALSE, warning=FALSE}
rawWages["Based_rich_nation"] = wagesClaned$Based_rich_nation

# Criar um fator com base na riqueza da nação
fator_ordenados <- factor(rawWages$Based_rich_nation, levels = c(0, 1))

# Plotar o boxplot ajustado
ggplot(data = rawWages, aes(x = fator_ordenados, y = Salary, fill = as.factor(Based_rich_nation))) +
  geom_boxplot() +
  labs(title = "Salários por Pertencimento a Nações Ricas",
       x = "Riqueza da Nação",
       y = "Salário dos jogadores") +
  scale_fill_manual(values = c("0" = "red", "1" = "blue"), 
                    name = "Riqueza da Nação",
                    labels = c("Pobre", "Rica")) +
  theme(plot.title = element_text(hjust = 0.5, size = 16, face = "bold"))
``` 
  
  Pela escala usada no eixo y do grafico, a riqueza em detalhes é reduzida, mas a piori é notório que os maiores salários então presentes na coluna '1' correspondente aos pertencentes aos paises ricos. Portanto, para uma inferencia mais precisa foi feito um tratamento de dados para visualizar somente ate o 3º quartil dos box, assim podendo comparar as medianas e desvios padrões para concluir a inferencia.

```{r t4_2, echo=TRUE, message=FALSE, warning=FALSE}
# Adicionar a coluna Based_rich_nation ao dataframe rawWages
rawWages["Based_rich_nation"] = wagesClaned$Based_rich_nation

# Filtrar jogadores por nações ricas e pobres
ricas <- rawWages %>% filter(Based_rich_nation == 1)
pobres <- rawWages %>% filter(Based_rich_nation == 0)

# Calcular o terceiro quartil para cada grupo
Q3_ricas <- quantile(ricas$Salary, 0.75, na.rm = TRUE)
Q3_pobres <- quantile(pobres$Salary, 0.75, na.rm = TRUE)

# Filtrar salários até o terceiro quartil
rawWages_filtered <- rawWages %>%
  filter((Based_rich_nation == 1 & Salary <= Q3_ricas) |
         (Based_rich_nation == 0 & Salary <= Q3_pobres))

# Criar um fator com base na riqueza da nação
fator_ordenados <- factor(rawWages_filtered$Based_rich_nation, levels = c(0, 1))

# Plotar o boxplot ajustado
ggplot(data = rawWages_filtered, aes(x = fator_ordenados, y = Salary, fill = as.factor(Based_rich_nation))) +
  geom_boxplot() +
  labs(title = "Salários por Pertencimento a Nações Ricas",
       x = "Riqueza da Nação",
       y = "Salário") +
  scale_fill_manual(values = c("0" = "red", "1" = "blue"), 
                    name = "Riqueza da Nação",
                    labels = c("Pobre", "Rica")) +
  theme(plot.title = element_text(hjust = 0.5, size = 16, face = "bold"))
```   
  
#### Conclusões Tópico 4

  Pela visualização do grafico são nitídos 2º e 3º quartil superiores nos paises ricos. Portanto, infere-se que a média salarial nos paises ricos é mais alta com menor volatilidade. 
  
### Tópico 5: Maiores tempos de contrato tendem a possuir maiores salários

#### **Hipótese**

  Maiores tempos de contrato tendem a possuir maiores salários
  
#### Metodologia de análise

  Para fazer a inferencia e avaliar a confirmação da hipótese, primeiro foi avaliado pelo teste da ANOVA se existe diferença significativa entre os salários dos diferentes tempos de contrato. 
  
```{r t5_1, echo=TRUE, message=FALSE, warning=FALSE}
# Converter as colunas de datas para o formato Date
rawWages$Begins <- as.Date(rawWages$Begins, format = "%Y/%m/%d")
rawWages$Expires <- as.Date(rawWages$Expires, format = "%Y/%m/%d")

# Calcular a duração do contrato em anos, arredondar para inteiros e garantir que sejam não-negativos
rawWages <- rawWages %>%
  mutate(Contract_Duration = pmax(0, round(as.numeric(difftime(Expires, Begins, units = "days")) / 365)))

# Remover linhas com valores ausentes ou não numéricos nas colunas Salary e Contract_Duration_Category
rawWages_clean <- rawWages %>%
  filter(!is.na(Salary) & !is.na(Contract_Duration) & is.finite(Salary))
```   

  No trecho acima os dados foram tratados para uma formatação adequada para trabalhar com dados,e calculado o tempo de contrato de cada jogador em uma nova coluna chamada "Contract_Duration". A partir dos dados tratados foi calculada a ANOVA com os resultados a seguir:
  
```{r t5_2, echo=TRUE, message=FALSE, warning=FALSE}
# Executar a ANOVA
anova_Contract <- aov(Salary ~ Contract_Duration, data = rawWages_clean)

# Ver os resultados da ANOVA
summary(anova_Contract)
```   

  Com base nos resultados da ANOVA:

- O valor F (4.634) e o valor p (0.00305) indicam que há uma diferença significativa nos salários dos jogadores com base na duração do contrato. Como o valor p é menor que 0.05, podemos rejeitar a hipótese nula de que não há diferença nos salários entre as diferentes durações de contrato.

  O teste da ANOVA confirmou uma diferença significativa entre os salários a partir dos diferentes tempos de contrato, então foi realizado um boxplot para visualizar essa diferençade maneira mais clara e indentificar comportamentos. Segue o boxplot abaixo: 
  
```{r t5_3, echo=TRUE, message=FALSE, warning=FALSE}
# Criar o gráfico boxplot
ggplot(data = rawWages_clean, aes(x = factor(Contract_Duration), y = Salary)) +
  geom_boxplot(outlier.shape = NA) +  # Remover outliers para focar no terceiro quartil
  stat_summary(fun = median, geom = "point", shape = 20, size = 2, color = "red", fill = "red") +  # Adicionar ponto da mediana
  labs(title = "Distribuição dos Salários por Duração do Contrato",
       x = "Duração do Contrato (anos)",
       y = "Salário") +
  scale_fill_brewer(palette = "Set3") +  # Adicionar uma paleta de cores
  theme_grey() +
  theme(plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
        axis.title = element_text(size = 12, face = "bold"),
        axis.text.x = element_text(size = 6),  # Diminuir a fonte do eixo x
        axis.text = element_text(size = 10)) +
  coord_cartesian(ylim = c(0, quantile(rawWages_clean$Salary, 0.80)))  # Limitar o eixo y ao terceiro quartil
```   

  No plot acima é visível uma variação de medianas seguindo tendências inesperadas. Por hipótese, esperava-se um crescimento contínuo com o aumento do tempo de contrato. No entanto, o gráfico apresenta baixa variância das medianas para determinados intervalos, com quedas e aumentos significativamente repentinos em alguns trechos, tornando difícil estimar uma tendência de crescimento geral. Portanto, foi realizada uma inferência adicional dos dados por meio da correlação de Pearson:
  
```{r t5_4, echo=TRUE, message=FALSE, warning=FALSE}
# Calcular a correlação de Pearson entre salário e duração do contrato
salarios <- rawWages_clean$Salary
duracao <- rawWages_clean$Contract_Duration

# Calcula a correlação de Pearson usando a função do R
correlacaoPearson <- cor(salarios, duracao, method = "pearson")
correlacaoPearson
```   
  
  Sendo a correlação de Person menor que zero, é esperada uma relação de crescimeto inversamente proporcional entre as duas variaveis. Contudo, tal comportamento é observado em pouquissimos trechos do plot onde apresenta muita instabilidade na tendencia esperada atraves do resultado da correlação inferida.
  
#### Conclusão Tópico 5
  A diferença salarial foi evidente em todos os testes realizados para avaliar a hipótese. No entanto, não foi observado um padrão de crescimento diretamente proporcional no teste de visualização do boxplot, e essa tendência foi totalmente negada na análise de correlação de Pearson. Portanto, não há uma relação de crescimento diretamente proporcional entre as duas variáveis na análise descritiva, e essa correlação é influenciada diretamente por outras variáveis.
  
  
  
### Tópico 6: Diferença de Salário com Base na Posição
#### **Hipótese**
  A divisão do clube do jogador interfere de maneira significativa no salário.

#### Metodoligia de análise
  Para avaliar a hipótese foram separados as 5 divisões mais predominantes entre os jogadores da base. Foram feitos testes da ANOVA verificando se existe diferença significativa de salário entre os jogadores das diferentes divisões, e por teste de tukey foram avaliadas as diferenças entre os pares de clubes individualemente.
  
```{r t6_1, echo=TRUE, message=FALSE, warning=FALSE}
#### TOPICO 6
# Contar o número de jogadores por divisão e selecionar as 5 mais predominantes
top_divisions <- names(sort(table(rawWages$Division), decreasing = TRUE))[1:5]

rawWages_top_divisions <- rawWages[rawWages$Division %in% top_divisions, ]

# Remover caracteres não numéricos e converter para numérico
rawWages_top_divisions$Salary <- as.numeric(gsub("[^0-9]", "", rawWages_top_divisions$Salary))

# Criar uma coluna para categorizar as divisões
rawWages_top_divisions$Division_Category <- factor(rawWages_top_divisions$Division, levels = top_divisions)
```  

  - Acima foram obtidos as divisões mais predominantes e separadas em uma coluna, sendo elas:
```{r t6_2, echo=FALSE, message=FALSE, warning=FALSE}
top_divisions
```  
  
##### Teste da ANOVA
  Com os dados tratados da maneira necessaria, segue o teste realizado:
```{r t6_3, echo=TRUE, message=FALSE, warning=FALSE}
##Executar ANOVA e Tukey HSD (substitua com seus dados reais)
anova_Division <- aov(Salary ~ Division_Category, data = rawWages_top_divisions)
summary(anova_Division)
```   

  Os resultados da ANOVA indicam que há uma diferença significativa nos salários entre as divisões. A estatística F é alta (191.6), e o valor p é extremamente baixo (praticamente zero), o que nos leva a rejeitar a hipótese nula de que não há efeitos significativos das divisões nos salários. Isso sugere que pelo menos uma das divisões tem uma média de salário significativamente diferente das outras.

Portanto, com base nos resultados da ANOVA, podemos concluir que as divisões têm um impacto estatisticamente significativo nos salários dos jogadores, e agora podemos prosseguir com o teste de Tukey para identificar quais divisões diferem entre si.

##### Teste de Tukey HSD
  A partir dos resultados da ANOVA foi realizado teste de Tukey a seguir para inferir os resultados e fazer as conclusões:

```{r t6_4, echo=TRUE, message=FALSE, warning=FALSE}
# Teste de Tukey para comparação múltipla
tukey_result <- TukeyHSD(anova_Division)

# Extrair resultados do teste de Tukey
tukey_data <- as.data.frame(tukey_result$Division_Category)
tukey_data$comparison <- rownames(tukey_data)

print(tukey_result)
```   
  
  Sendo esses os resultados obtidos, foram plotados no gráfico a seguir para melhor visualização e interpretação:

```{r t6_5, echo=TRUE, message=FALSE, warning=FALSE}
# Gráfico dos Resultados do Teste de Tukey HSD com ajustes
ggplot(tukey_data, aes(x = comparison, y = diff, ymin = lwr, ymax = upr)) +
  geom_errorbar(width = 0.2, color = "blue") +
  geom_point(size = 1, color = "red") +
  labs(title = "Resultados do Teste de Tukey HSD",
       x = "Comparação de Divisões",
       y = "Diferença de Salário") +
  theme_minimal(base_size = 10) +  # Ajustar tamanho do texto base
  theme(axis.text.x = element_text(angle = 60, hjust = 0.5, vjust = 0.5),
        plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),  # Centralizar e ajustar tamanho do título
        legend.key.size = unit(0.15, "cm")) +  # Reduzir o tamanho da legenda
  geom_hline(yintercept = 0, linetype = "dashed", color = "black")  # Adicionar linha de referência

```   

##### Como interpretar no plot Tukey HSD
  
1. Diferenças Significativas

- As barras de erro que não cruzam a linha zero indicam que há uma diferença significativa entre os salários das divisões comparadas.
- Comparações que possuem uma barra de erro totalmente acima ou abaixo da linha zero indicam que as diferenças de salários entre essas divisões são estatisticamente significativas.

2. Magnitude das Diferenças

- A altura dos pontos e o comprimento das barras de erro mostram a magnitude da diferença salarial entre as divisões comparadas.
- Comparações como "Premier League - Serie A TIM" mostram uma diferença positiva significativa, indicando que os salários na Premier League são significativamente maiores do que na Serie A TIM.

3. Interpretação das Comparações

- Comparações como "Sky Bet Championship - Serie A TIM" e "Ligue 2 BKT - Serie A TIM" indicam que os salários na Serie A TIM são significativamente maiores do que nas ligas comparadas, já que a diferença é negativa.

##### Conclusão Tópico 6
  O teste da ANOVA mostrou evidências de diferenças significativas, e o teste de Tukey HSD confirmou. Entre as 5 divisões avaliadas, os pares de comparação "Serie BKT - Ligue 2 BKT" e "Serie BKT - Sky Bet Championship" são os únicos que apresentam diferenças tão baixas que chegam a ser insignificativas. No entanto, todas as demais comparações manifestaram grandes diferenças, onde a "Serie A TIM" foi a divisão mais predominante em diferenças significativas. Portanto, com uma pequena amostra de divisões, já é possível inferir diferenças salariais significativas entre os jogadores.
  
  
## Conclusão Geral
  Os salários dos jogadores de futebol são afetados por uma variedade de fatores, conforme demonstrado pelas análises das diferentes hipóteses:

1. Participações na Seleção (Caps):

  - Conclusão: Jogadores com mais participações na seleção tendem a obter melhores salários. Embora não seja uma regra absoluta, há uma tendência geral de aumento salarial com o aumento do número de caps, influenciado por outras variáveis.

2. Idade dos Jogadores:

  - Conclusão: A relação entre idade e salário não é clara. A regressão linear indicou uma tendência fraca, com maior variabilidade salarial observada entre 25 e 35 anos. Assim, a idade por si só não é um determinante forte dos salários.
  
3. Nacionalidade dos Jogadores:

  - Conclusão: Não foram encontradas diferenças salariais estatisticamente significativas entre jogadores de diferentes nacionalidades dentro do conjunto de dados analisado. Portanto, a nacionalidade não é um fator predominante na determinação dos salários.

4. Riqueza das Nações:

  - Conclusão: Jogadores de nações consideradas ricas tendem a ter maiores médias salariais. Isso indica que a origem de jogadores de países ricos pode influenciar positivamente seus salários, possivelmente devido a melhores condições de treinamento e maior visibilidade.

5. Duração dos Contratos:

  - Conclusão: A análise revelou diferenças salariais associadas ao tempo de contrato, mas não foi observada uma relação diretamente proporcional. Outros fatores influenciam a correlação entre duração do contrato e salários.

6. Divisão do Clube:

  - Conclusão: A divisão do clube do jogador tem um impacto significativo nos salários. A análise ANOVA e o teste de Tukey HSD mostraram que algumas divisões, especialmente a "Serie A TIM", apresentaram diferenças salariais significativas em comparação com outras divisões.

## Considerações Finais

  Os salários dos jogadores de futebol são multifacetados e influenciados por uma combinação de fatores. Embora algumas variáveis como participações na seleção e riqueza das nações tenham uma influência positiva clara, outras como idade e duração do contrato mostram relações mais complexas e dependentes de múltiplos fatores. A divisão do clube é um determinante significativo, destacando a importância do nível da liga na remuneração dos jogadores.
